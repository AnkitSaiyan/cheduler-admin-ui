<div class="d-flex flex-column dfm-gap-16 position-relative">
  <section>
    <div class="d-flex align-items-center dfm-gap-16 flex-1 et-ls-section-1">
      <dfm-input
        class="flex-1 et-ls-search"
        size="md"
        placeholder="Search by Template Name"
        icon="search-sm"
        [formControl]="searchControl"
      ></dfm-input>

      <div class="d-flex align-items-center dfm-button-group-wrapper et-ls-button-dropdown-group">
        <div class="dfm-button-icon-bg-transparent" [cdkCopyToClipboard]="clipboardData">
          <dfm-button-icon color="tertiary-gray" size="md" icon="copy-03" (click)="copyToClipboard()"></dfm-button-icon>
        </div>

        <div class="dfm-dropdown-placeholder-text-primary dfm-dropdown-bg-transparent">
          <dfm-input-dropdown
            [items]="downloadItems"
            [showDescription]="false"
            [formControl]="downloadDropdownControl"
            placeholder="Download"
            size="md"
          ></dfm-input-dropdown>
        </div>
      </div>
    </div>
  </section>


  <section class="list-page-content-height" *ngIf="filteredEmails$$ | async as emails">
    <dfm-table
      [items]="emails"
      [selectable]="true"
      (selected)="handleCheckboxSelection($event)"
      [clearSelected$]="clearSelected$$"
      [rowClickable]="true"
      class="dfm-table-wrapper"
    >
      <ng-template #headerRowTemplate>
        <dfm-table-header-cell *ngFor="let column of columns">{{ column }}</dfm-table-header-cell>
      </ng-template>

      <ng-template #bodyRowTemplate let-item>
        <dfm-table-body-cell>{{ item.title | titlecase | dashIfNothing }}</dfm-table-body-cell>
        <dfm-table-body-cell>{{ item.subject | titlecase | dashIfNothing }}</dfm-table-body-cell>
        <dfm-table-body-cell>
          <dfm-badge *ngIf="item.status === statusType.Active" color="success" size="sm" fontWeight="medium">
            {{ item.status | statusName | dashIfNothing }}
          </dfm-badge>

          <dfm-badge *ngIf="item.status === statusType.Inactive" color="primary" size="sm">
            {{ item.status | statusName | dashIfNothing }}
          </dfm-badge>
        </dfm-table-body-cell>

          <div class="d-flex dfm-gap-16 align-items-center et-ls-action-buttons">
            <dfm-button
              *ngIf="item.status === statusType.Inactive"
              color="link-gray"
              size="sm"
              trailingIcon="check-circle"
              (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Active }])"
            ></dfm-button>

            <dfm-button
              *ngIf="item.status === statusType.Active"
              color="link-gray"
              size="sm"
              trailingIcon="x-circle"
              (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Inactive }])"
            ></dfm-button>

            <dfm-button color="link-gray" size="sm" trailingIcon="pencil-02" [routerLink]="['./', item.id, 'edit']" (click)="$event.stopPropagation()"></dfm-button>
          </div>

          <div class="position-relative">
            <div ngbDropdown #actionButtonsMenu="ngbDropdown">
              <div class="shadow-lg et-ls-action-buttons-menu et-ls-menus" ngbDropdownMenu aria-labelledby="dropdownManual">
                <div
                  ngbDropdownItem
                  *ngIf="item.status === statusType.Inactive"
                  (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Active }])"
                >
                  <dfm-button trailingIcon="check-circle" color="link-gray"></dfm-button>
                </div>
                <div
                  ngbDropdownItem
                  *ngIf="item.status === statusType.Active"
                  (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Inactive }])"
                >
                  <dfm-button trailingIcon="x-circle" color="link-gray"></dfm-button>
                </div>
                <div ngbDropdownItem (click)="$event.stopPropagation()" class="position-relative">
                  <dfm-button trailingIcon="pencil-02" color="link-gray" routerLink="./edit"></dfm-button>
                  <div class="menu-point-forward shadow-sm"></div>
                </div>
              </div>
            </div>

            <dfm-button
              class="hidden et-ls-vertical-dots-btn"
              color="link-gray"
              size="sm"
              trailingIcon="dots-vertical"
              (click)="$event.stopPropagation(); actionButtonsMenu.open()"
            ></dfm-button>
          </div>
        <!-- </dfm-table-body-cell>  -->


        <dfm-table-body-cell>
          <div class="d-flex dfm-gap-16 align-items-center pr-li-action-buttons">
            <dfm-button
              *ngIf="item.status === statusType.Inactive"
              color="link-gray"
              size="sm"
              trailingIcon="check-circle"
              (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Active }])"
            ></dfm-button>

            <dfm-button
              *ngIf="item.status === statusType.Active"
              color="link-gray"
              size="sm"
              trailingIcon="x-circle"
              (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Inactive }])"
            ></dfm-button>

            <dfm-button color="link-gray" size="sm" trailingIcon="pencil-02" [routerLink]="['./', item.id, 'edit']" (click)="$event.stopPropagation()"></dfm-button>
          </div>

          <!-- Action Menu -->
          <dfm-button
            [ngbPopover]="actionMenu"
            autoClose="autoClose"
            triggers="click"
            container="body"
            placement="left"
            popoverClass="popover-p-0"
            class="hidden pr-li-vertical-dots-btn"
            color="link-gray"
            size="sm"
            trailingIcon="dots-vertical"
            (click)="$event.stopPropagation(); toggleMenu(true)"
          ></dfm-button>

          <ng-template #actionMenu>
            <div class="pr-li-menus"
                aria-labelledby="dropdownManual">
                <div
                  *ngIf="item.status === statusType.Inactive"
                  (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Active }])"
                >
                  <dfm-button trailingIcon="check-circle" color="link-gray"></dfm-button>
                </div>
                <div
                  *ngIf="item.status === statusType.Active"
                  (click)="$event.stopPropagation(); changeStatus([{ id: item.id, newStatus: statusType.Inactive }])"
                >
                  <dfm-button trailingIcon="x-circle" color="link-gray"></dfm-button>
                </div>
                <div  (click)="$event.stopPropagation()" class="position-relative">
                  <dfm-button trailingIcon="pencil-02" color="link-gray" [routerLink]="['./', item.id, 'edit']"></dfm-button>
                </div>
            </div>
          </ng-template>
          <!-- Action Menu End-->

        </dfm-table-body-cell>
      </ng-template>
    </dfm-table>
    <div class="d-flex justify-content-center dfm-p-16 dfm-mx-2 bg-white rounded-bottom" *ngIf="!emails.length">No data found</div>
  </section>
  <div ngbDropdown #optionsMenu="ngbDropdown">
    <div class="shadow-lg et-ls-plus-btn-menu et-ls-menus" ngbDropdownMenu aria-labelledby="dropdownManual">
      <div ngbDropdownItem (click)="$event.stopPropagation()">
        <dfm-button trailingIcon="search-sm" color="link-gray"></dfm-button>
      </div>
      <div ngbDropdownItem (click)="$event.stopPropagation(); toggleMenu()">
        <dfm-button trailingIcon="copy-03" color="link-gray"></dfm-button>
      </div>
      <div ngbDropdownItem (click)="$event.stopPropagation(); toggleMenu()">
        <dfm-button trailingIcon="download-01" color="link-gray"></dfm-button>
      </div>
    </div>
  </div>

</div>

<dfm-confirm-status-change-banner
  [display]="selectedUserIds.length"
  (confirmationEvent)="handleConfirmation($event)"
></dfm-confirm-status-change-banner>

