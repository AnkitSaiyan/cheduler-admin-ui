<div class="position-relative">
  <div class="d-flex flex-column dfm-gap-24 dfm-pb-8 ap-li-main-wrapper">
    <section class="dfm-px-16 dfm-pt-16 d-flex flex-column dfm-gap-8">
      <header class="d-flex align-items-center dfm-gap-8">
        <div class="dfm-button-gray-400">
          <dfm-button size="md" leadingIcon="drag" color="link-gray"></dfm-button>
        </div>
        <span class="font-weight-medium">{{ 'AppointmentsList' | translate }}</span>
      </header>
    </section>

    <section>
      <div class="d-flex dfm-gap-8 align-items-center flex-1 dfm-px-16 ap-li-section2-action-bar">
        <dfm-input size="md" placeholder="{{ 'Search' | translate }}" icon="search-sm" class="flex-1" [formControl]="searchControl"></dfm-input>

        <dfm-input
          size="md"
          placeholder="{{ 'AdvancedSearch' | translate }}"
          icon="search-sm"
          class="flex-1"
          (click)="openAdvancePopup()"
        ></dfm-input>

      <div class="d-flex align-items-center dfm-button-group-wrapper">
        <div [cdkCopyToClipboard]="clipboardData">
          <dfm-button-icon
            color="tertiary-gray"
            size="md"
            icon="copy-03"
            ngbPopover="{{ 'ClickToCopy' | translate }}"
            triggers="mouseenter:mouseleave"
            popoverClass="popover-p-8"
            [openDelay]="200"
            (click)="copyToClipboard()"
          ></dfm-button-icon>
        </div>

          <div class="download-dropdown-max-w-144">
            <dfm-input-dropdown
              [items]="downloadItems"
              [showDescription]="false"
              [formControl]="downloadDropdownControl"
              placeholder="{{ 'Download' | translate }}"
              size="md"
            ></dfm-input-dropdown>
          </div>
        </div>

        <!-- <dfm-button
        color="secondary"
        size="md"
      >{{"Confirm" | translate}}
      </dfm-button> -->

        <dfm-button color="primary" size="md" class="text-nowrap" routerLink="/appointment/add" [state]="{ comingFromRoute: 'dashboard' }"
          >{{ 'AddAppointment' | translate }}
        </dfm-button>
      </div>

      <div class="hidden align-items-center dfm-gap-16 dfm-px-8 justify-content-center ap-li-section2-action-bar-mv hide-scrollbar overflow-x-auto">
        <dfm-button-icon color="secondary-gray" size="md" icon="search-sm"></dfm-button-icon>

        <dfm-button-icon color="secondary-gray" size="md" icon="filter-funnel-01"></dfm-button-icon>

      <div class="d-flex align-items-center dfm-button-group-wrapper">
        <div>
          <dfm-button-icon
            color="tertiary-gray"
            size="md"
            icon="copy-03"
            ngbPopover="{{ 'ClickToCopy' | translate }}"
            triggers="mouseenter:mouseleave"
            popoverClass="popover-p-8"
            [openDelay]="200"
          ></dfm-button-icon>
        </div>

          <div>
            <dfm-button-icon color="tertiary-gray" size="md" icon="download-01"></dfm-button-icon>
          </div>
        </div>

        <dfm-button-icon color="secondary-gray" size="md" icon="calendar-date"></dfm-button-icon>

        <dfm-button color="primary" size="md" class="text-nowrap" [disabled]="false">Add </dfm-button>
      </div>
    </section>

    <section class="table-wrapper" *ngIf="filteredAppointments$$ | async as appointments">
      <dfm-table
        [items]="appointments"
        [selectable]="true"
        (selected)="handleCheckboxSelection($event)"
        [clearSelected$]="clearSelected$$"
        [rowClickable]="true"
        (rowClicked)="navigateToView($event, appointments)"
        class="dfm-table-wrapper"
      >
        <ng-template #headerRowTemplate>
          <dfm-table-header-cell *ngFor="let column of columns">{{ column }}</dfm-table-header-cell>
        </ng-template>
        <ng-template #bodyRowTemplate let-item>
          <dfm-table-body-cell>{{ (item?.exams.length ? (item.startedAt | date : 'y-MM-dd HH:mm') : 'abc') | dashIfNothing }}</dfm-table-body-cell>
          <dfm-table-body-cell>{{ (item?.exams.length ? (item.endedAt | date : 'y-MM-dd HH:mm') : 'bh') | dashIfNothing }}</dfm-table-body-cell>
          <dfm-table-body-cell>{{ item?.patientFname | titlecase }}</dfm-table-body-cell>
          <dfm-table-body-cell>{{ item?.doctor | titlecase }}</dfm-table-body-cell>
          <dfm-table-body-cell>{{ item?.id }}</dfm-table-body-cell>
          <dfm-table-body-cell>{{ item?.createdAt }}</dfm-table-body-cell>
          <dfm-table-body-cell>
            <span>{{ item.readStatus === readStatus.Read ? 'Yes' : 'No' }}</span>
          </dfm-table-body-cell>
          <dfm-table-body-cell>
            <dfm-badge *ngIf="item.approval === statusType.Approved" color="success" size="sm" fontWeight="medium">
              {{ item.approval | approvalTypeName | dashIfNothing }}
            </dfm-badge>

            <dfm-badge *ngIf="item.approval === statusType.Cancelled" color="primary" size="sm">
              {{ item.approval | approvalTypeName | dashIfNothing }}
            </dfm-badge>

            <dfm-badge *ngIf="item.approval === statusType.Pending" color="gray" size="sm">
              {{ item.approval | approvalTypeName | dashIfNothing }}
            </dfm-badge>
          </dfm-table-body-cell>
          <dfm-table-body-cell>
            <div class="d-flex align-items-center dfm-gap-14">
              <!-- <dfm-button
              *ngIf="!item.confirm"
              color="link-gray"
              size="md"
              trailingIcon="check-circle"
              ngbPopover="{{ 'ChangeStatus' | translate }}"
              triggers="mouseenter:mouseleave"
              popoverClass="popover-p-8"
              [openDelay]="200"
            ></dfm-button>
            <dfm-button
              *ngIf="item.confirm"
              color="link-gray"
              size="md"
              trailingIcon="x-circle"
            ></dfm-button> -->
              <dfm-button
                color="link-gray"
                size="md"
                trailingIcon="pencil-02"
                [routerLink]="['/appointment', item.id, 'edit']"
                [state]="{ comingFromRoute: 'dashboard', edit: true }"
              ></dfm-button>
              <dfm-button color="link-gray" size="md" trailingIcon="trash-01" (click)="deleteAppointment(item.id)"> </dfm-button>
            </div>
          </dfm-table-body-cell>
        </ng-template>
      </dfm-table>
    </section>
  </div>

  <dfm-confirm-status-change-banner
    [display]="selectedAppointmentIDs.length"
    [statusType]="'appointment'"
    (confirmationEvent)="handleConfirmation($event)"
  ></dfm-confirm-status-change-banner>
</div>
