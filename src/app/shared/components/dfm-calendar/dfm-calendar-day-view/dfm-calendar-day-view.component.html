<div role="grid" class="calender-day-view">
  <div class="calender-day-view-absolute">
    <div class="calender-day-view-container" >
      <div role="presentation" class="calender-day-view-header " >
        <div class="text-xs calender-day-view-time-zone">
          <div>
            {{ (selectedDate | date : 'OOOO')?.split('+')?.join(' +') }}
          </div>
        </div>

        <div role="presentation" class="calender-day-view-weekday-header hide-scrollbar" (scroll)="onScroll(scrollOne, scrollTwo)" #scrollOne>
          <div role="row" class="calender-day-view-weekdays">
            <div class="calender-day-view-weekday-header-left-vertical-line"></div>
            <ng-container *ngIf="headerList?.length; else todayHeader">
              <div role="columnheader" class="calender-day-view-weekday flex-1" *ngFor="let header of headerList">
                <div class="calender-day-view-header-cell-left-line"></div>
                  <div
                    class="text-xs font-weight-medium w-fit calender-day-view-day-name d-flex align-items-center dfm-gap-8">{{ header.name | titlecase }}
                    <div class="calender-month-view-day-exam-event-container" *ngIf="hideAppointmentData[header.name]?.length" #parentElement >

                      <div *ngFor="let data of hideAppointmentData[header.name]"  [ngbPopover]="mainAppointmentPopover" #popOver="ngbPopover" triggers="hover" [autoClose]="'outside'" container="body">
                        <div class="calender-month-view-day-exam-event-details d-flex" [routerLink]="['/', 'appointment', data.id, 'view']" queryParamsHandling="merge">
                          <span class="calender-month-view-day-exam-event-title text-truncate d-flex flex-column font-10 ">
                            <span  class="text-truncate">
                              <b>{{data?.id}} - {{(data?.patientFname | titlecase) + ' ' + data?.patientLname | titlecase }}</b>
                            </span>
                            <span>
                            {{ data?.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true}}
                            -
                            {{ data?.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true}}
                          </span>
                          </span>
                          <div class="header-appointment-dot-btn" (click)="$event.stopPropagation();" [matMenuTriggerFor]="menu"
                                 >
                              <svg *ngIf="data.isEditable" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                   xmlns="http://www.w3.org/2000/svg">
                                <path
                                  d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"
                                  stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path
                                  d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z"
                                  stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path
                                  d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z"
                                  stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>

                              <mat-menu #menu="matMenu">
                                <button mat-menu-item (click)="changeRadiologists(data);">
                                  <div class="icon-20">
                                    <dfm-icon name="home-03"></dfm-icon>
                                  </div>
                                  <span>{{ 'ChangeRadiologist' | translate }}</span>
                                </button>

                                <button mat-menu-item [routerLink]="['/', 'appointment', data.id, 'edit']" queryParamsHandling="merge"
                                  [state]="{ edit: true, comingFromRoute: 'appointment' }">
                                  <div class="icon-20">
                                    <dfm-icon name="pencil-02"></dfm-icon>
                                  </div>
                                  <span>{{ 'Edit' | translate }}</span>
                                </button>

                                <div class="dropdown-divider"></div>

                                <button mat-menu-item (click)=" deleteAppointment(data.id);">
                                  <div class="icon-20">
                                    <dfm-icon name="trash-01"></dfm-icon>
                                  </div>
                                  <span>{{ 'Delete' | translate}}</span>
                                </button>
                              </mat-menu>
                          </div>
                        </div>
                        <ng-template #mainAppointmentPopover>
                          <div class="calender-day-view-event-details-expanded">
                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium"> {{"Exam" | translate}}</span>
                              <span *ngIf="data.exams?.length">{{ data.exams | joinWithAnd : 'name'}}</span>
                            </div>

                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium dfm-mt-8"> {{"SelectedSlot" | translate}} </span>
                              <span class="calendar-comments-text">{{ data.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }} -
                                {{ data.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }}</span>
                            </div>

                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium dfm-mt-8"> {{"Comments" | translate}} </span>
                              <span class="calendar-comments-text"> {{ data?.comments | dashIfNothing }}</span>
                            </div>

                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium dfm-mt-8">{{"Staff" | translate}}</span>
                              <ng-container *ngIf="data.exams | isData : 'users'; else dash">
                                <div *ngFor="let exam of data.exams" class="dfm-ps-4 dfm-pt-4">
                                  <div *ngFor="let user of exam?.users"
                                       class="d-flex align-items-center dfm-gap-8 dfm-pt-4 dfm-pb-4">
                                    <div class="circle-gray-200-40">
                                      {{ user?.firstname?.length ? (user.firstname[0] | uppercase) : '' }}
                                    </div>
                                    <div class="d-flex flex-column">
                                      <span>{{ user?.firstname | titlecase }} {{ user?.lastname | titlecase }}</span>
                                      <span class="dfm-text-main-500">{{ user?.userType | titlecase }}</span>
                                    </div>
                                  </div>
                                </div>
                              </ng-container>
                              <ng-template #dash>
                                <span>{{ '' | dashIfNothing }}</span>
                              </ng-template>
                            </div>
                          </div>
                        </ng-template>
                      </div>

                      <div *ngIf="parentElement.scrollHeight > parentElement.clientHeight" class="calender-month-view-day-exam-event-details more-btn" [matMenuTriggerFor]="eventDetail">
                        <span class="calender-month-view-day-exam-event-title text-truncate">View more</span>

                        <mat-menu #eventDetail="matMenu">
                          <div class="calender-month-view-day-exam-details-expanded">
                            <div class="dfm-card-container" style="padding: 0 8px;">
                              <div *ngFor="let data of hideAppointmentData?.[header.name]"  [ngbPopover]="appointmentPopover" #popOver="ngbPopover" triggers="hover" [autoClose]="'outside'" container="body">
                                <div class="calender-month-view-day-exam-event-details d-flex"
                                  [routerLink]="['/', 'appointment', data.id, 'view']" queryParamsHandling="merge">
                                  <span class="calender-month-view-day-exam-event-title text-truncate d-flex flex-column font-10" >
                                    <span class="text-truncate">
                                      <b>{{data?.id}} - {{(data?.patientFname | titlecase) + ' ' + data?.patientLname | titlecase }}</b>
                                    </span>
                                    <span>
                                      {{ data?.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true}}
                                      -
                                      {{ data?.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true}}
                                    </span>
                                  </span>
                                  <div *ngIf="data.isEditable" class="header-appointment-dot-btn"  [matMenuTriggerFor]="menu" (click)="$event.stopPropagation();">
                                    <svg  width="24" height="24" viewBox="0 0 24 24" fill="none"
                                      xmlns="http://www.w3.org/2000/svg">
                                      <path
                                        d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"
                                        stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                      <path
                                        d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z"
                                        stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                      <path
                                        d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z"
                                        stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>

                                    <mat-menu #menu="matMenu" style="z-index: 5;">
                                      <button mat-menu-item (click)="changeRadiologists(data);">
                                        <div class="icon-20">
                                          <dfm-icon name="home-03"></dfm-icon>
                                        </div>
                                        <span>{{ 'ChangeRadiologist' | translate }}</span>
                                      </button>

                                      <button mat-menu-item [routerLink]="['/', 'appointment', data.id, 'edit']" queryParamsHandling="merge"
                                        [state]="{ edit: true, comingFromRoute: 'appointment' }">
                                        <div class="icon-20">
                                          <dfm-icon name="pencil-02"></dfm-icon>
                                        </div>
                                        <span>{{ 'Edit' | translate }}</span>
                                      </button>

                                      <div class="dropdown-divider"></div>

                                      <button mat-menu-item (click)=" deleteAppointment(data.id);">
                                        <div class="icon-20">
                                          <dfm-icon name="trash-01"></dfm-icon>
                                        </div>
                                        <span>{{ 'Delete' | translate}}</span>
                                      </button>
                                    </mat-menu>
                                  </div>
                                </div>
                                <ng-template #appointmentPopover>
                                  <div class="calender-day-view-event-details-expanded">
                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium"> {{"Exam" | translate}}</span>
                                      <span *ngIf="data.exams?.length">{{ data.exams | joinWithAnd : 'name'}}</span>
                                    </div>

                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium dfm-mt-8"> {{"SelectedSlot" | translate}} </span>
                                      <span class="calendar-comments-text">{{ data.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }} -
                                        {{ data.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }}</span>
                                    </div>

                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium dfm-mt-8"> {{"Comments" | translate}} </span>
                                      <span class="calendar-comments-text"> {{ data?.comments | dashIfNothing }}</span>
                                    </div>

                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium dfm-mt-8">{{"Staff" | translate}}</span>
                                      <ng-container *ngIf="data.exams | isData : 'users'; else dash">
                                        <div *ngFor="let exam of data.exams" class="dfm-ps-4 dfm-pt-4">
                                          <div *ngFor="let user of exam?.users"
                                               class="d-flex align-items-center dfm-gap-8 dfm-pt-4 dfm-pb-4">
                                            <div class="circle-gray-200-40">
                                              {{ user?.firstname?.length ? (user.firstname[0] | uppercase) : '' }}
                                            </div>
                                            <div class="d-flex flex-column">
                                              <span>{{ user?.firstname | titlecase }} {{ user?.lastname | titlecase }}</span>
                                              <span class="dfm-text-main-500">{{ user?.userType | titlecase }}</span>
                                            </div>
                                          </div>
                                        </div>
                                      </ng-container>
                                      <ng-template #dash>
                                        <span>{{ '' | dashIfNothing }}</span>
                                      </ng-template>
                                    </div>
                                  </div>
                                </ng-template>
                              </div>
                            </div>
                          </div>

                        </mat-menu>
                      </div>
                    </div>
                    <div class="calender-month-view-day-exam-event-container" *ngIf="hideAbsenceData[header.name]?.length" #parentAbsenceElement >
                      <div *ngFor="let data of hideAbsenceData[header.name]"  [ngbPopover]="mainAbsencePopover" #popOver="ngbPopover" triggers="hover" [autoClose]="'outside'" container="body">
                        <div class="calender-month-view-day-exam-event-details d-flex" >
                          <span class="calender-month-view-day-exam-event-title text-truncate d-flex flex-column font-10 ">
                            <span class="text-truncate">
                              {{ data?.start}}
                              -
                              {{ data?.end}} <b>{{data?.name | titlecase }}</b>
                            </span>
                          </span>
                        </div>
                        <ng-template #mainAbsencePopover>
                          <div class="calender-day-view-event-details-expanded">


                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium dfm-mt-8"> {{"AbsenceSlot" | translate}} </span>
                              <span class="calendar-comments-text">{{ data.start }} -
                                {{ data.end }}</span>
                            </div>

                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium dfm-mt-8"> {{"Info" | translate}} </span>
                              <span class="calendar-comments-text"> {{ data.info | dashIfNothing }}</span>
                            </div>

                            <div class="d-flex flex-column dfm-gap-4">
                              <span class="font-weight-medium dfm-mt-8"> {{(data?.roomName ? "Room" : 'Staff') | translate}} </span>
                              <span class="calendar-comments-text"> {{ (data.roomName ?? data.userName) | dashIfNothing }}</span>
                            </div>
                          </div>
                        </ng-template>
                      </div>

                      <div *ngIf="parentAbsenceElement.scrollHeight > parentAbsenceElement.clientHeight" class="calender-month-view-day-exam-event-details more-btn" [matMenuTriggerFor]="absenceEventDetail">
                        <span class="calender-month-view-day-exam-event-title text-truncate">View more</span>

                        <mat-menu #absenceEventDetail="matMenu">
                          <div class="calender-month-view-day-exam-details-expanded">
                            <div class="dfm-card-container" style="padding: 0 8px;">
                              <div *ngFor="let data of hideAbsenceData?.[header.name]"  [ngbPopover]="absencePopover" #popOver="ngbPopover" triggers="hover" [autoClose]="'outside'" container="body">
                                <div class="calender-month-view-day-exam-event-details d-flex" >
                                  <span class="calender-month-view-day-exam-event-title text-truncate d-flex flex-column font-10" >
                                    <span class="text-truncate">
                                      {{ data?.start}}
                                      -
                                      {{ data?.end}} <b>{{data?.name | titlecase }}</b>
                                    </span>
                                  </span>
                                </div>
                                <ng-template #absencePopover>
                                  <div class="calender-day-view-event-details-expanded">


                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium dfm-mt-8"> {{"SelectedSlot" | translate}} </span>
                                      <span class="calendar-comments-text">{{ data.start }} -
                                        {{ data.end }}</span>
                                    </div>

                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium dfm-mt-8"> {{"Info" | translate}} </span>
                                      <span class="calendar-comments-text"> {{ data.info | dashIfNothing }}</span>
                                    </div>

                                    <div class="d-flex flex-column dfm-gap-4">
                                      <span class="font-weight-medium dfm-mt-8"> {{(data?.roomName ? "Room" : 'Staff') | translate}} </span>
                                      <span class="calendar-comments-text"> {{ (data.roomName ?? data.userName) | dashIfNothing }}</span>
                                    </div>
                                  </div>
                                </ng-template>
                              </div>
                            </div>
                          </div>

                        </mat-menu>
                      </div>
                    </div>
                  </div>
              </div>
            </ng-container>


            <ng-template #todayHeader>
              <div role="columnheader" class="calender-day-view-weekday-alt">
                <div class="calender-day-view-header-cell-left-line"></div>
                <h3>
                  <div
                    class="text-xs font-weight-medium w-fit calender-day-view-day-name">{{ selectedDate.getDay() | weekdayToName : false : true | uppercase  }}</div>
                  <div class="w-fit calender-day-view-date"
                       [ngClass]="{ 'calender-day-view-date-today': todayDate.getDate() === selectedDateOnly && todayDate.getMonth() === selectedDate.getMonth() }">
                    {{ selectedDateOnly }}
                  </div>
                </h3>
              </div>

              <div role="columnheader" class="calender-day-view-weekday-alt flex-1 max-w-full">
                <h3>
                  <div class="text-xs font-weight-medium w-fit calender-day-view-day-name"></div>
                  <div class="w-fit calender-day-view-date"></div>
                </h3>
              </div>
            </ng-template>
          </div>

          <div class="">

          </div>
        </div>
      </div>

      <div class="calender-day-view-body-container hide-scrollbar">

        <div role="presentation" class="calender-day-view-body" #calendarView>
          <div role="row" class="calender-day-view-time-slot-container" *ngIf="timeSlot?.timings?.length && (isHoliday$$ | async) === false">
            <div class="calender-day-view-time-slot text-sm" *ngFor="let time of timeSlot?.timings" >
              <span>{{ time | dfmUtcToLocal: true }}</span>
              <div class="calender-day-view-horizontal-line"></div>
            </div>
            <ng-container *ngIf="prioritySlots && prioritySlots[day[0] + '-' + day[1] + '-' + day[2]]">
              <ng-container *ngFor="let prioritySlot of prioritySlots[day[0] + '-' + day[1] + '-' + day[2]]; let i = index">
                <div
                  *ngIf="getAbsenceTop([prioritySlot]) >= 0 && getAbsenceHeight(prioritySlot) as eventHeight"
                  class="priority-slots-area small"
                  [ngClass]="prioritySlot.priority"
                  [ngStyle]="{
                    'top.px': getAbsenceTop([prioritySlot]),
                    'height.px': eventHeight
                  }"
                >
                  <div class="priority-slot-percentage" [ngStyle]="{'top': eventHeight>20 ? '12px':'0', 'padding': eventHeight>20 ? '12px':'0'}" ></div>
                </div>
              </ng-container>
            </ng-container>
          </div>

          <div role="presentation" class="calender-day-view-events-container-main" #bodyMain (scroll)="onScroll(scrollTwo, scrollOne)" #scrollTwo>
            <div role="row" class="calender-day-view-events-container" *ngIf="timeSlot?.timings?.length && (isHoliday$$ | async) === false">
              <div class="gray-out-area"  *ngFor="let item of grayOutSlot$$ | async" [ngStyle]="{'top.px': item.top, 'height.px': item.height, 'width': bodyMain.style.width }" ></div>
              <div>
                <ng-container *ngFor="let i of timeSlot?.timings">
                  <div class="calender-day-view-horizontal-line"></div>
                  <div class="calender-day-view-horizontal-line-light"></div>
                </ng-container>
              </div>

              <div class="calender-day-view-events-left-vertical-line"></div>
              <ng-container *ngIf="headerList.length; else singleGridCol;">
                <div *ngFor="let h of headerList; let headerIndex = index" role="gridcell" class="calender-day-view-body-grid-column" dfmDragAreaEvent [calendarType]="calendarType.Day" [headerType]="h.name" (editAppointment)="addAppointment($event.event, undefined, $event.data)">
                  <div class="calender-day-view-body-grid-absolute"></div>

                  <div class="calender-day-view-body-events-container" role="presentation" #eventsContainer (dblclick)="addAppointment($event, eventsContainer)" >
                    <ng-container *ngIf="dataGroupedByDateAndRoom[dateString] as dataGroupedByRoom">
                      <ng-container
                        *ngIf="dataGroupedByRoom && dataGroupedByRoom[h.value] as roomData">
                        <ng-container
                          *ngFor="let data of roomData;">
                          <ng-container *ngIf="getHeight([data.appointment]) as eventHeight" >
                          <div *ngIf="calendarView.offsetHeight >= getTop([data.appointment]) + eventHeight && getTop([data.appointment]) >= 0"
                            #eventContainer class="calender-day-view-event-container resizable" triggers="hover" [ngbPopover]="eventDetails"
                            [autoClose]="'outside'" container="body" #popover="ngbPopover" [ngbPopoverDrag]="popover"
                            [draggable]="!((data.appointment.startedAt | dfmUtcToLocal : false : true) | isPreviousDay : true)" dfmDragEvent
                            [calendarType]="calendarType.Day" [draggedElData]="data.appointment" [headerType]="h.name"
                            (dblclick)="$event.preventDefault()" [ngStyle]="{ 'top.px': getTop([data.appointment]), 'height.px': eventHeight }"
                            [ngClass]="{
                            'affectedAppointments': data.appointment.absenceDetails?.length
                          }"
                            >
                          <div class='resizers' id="resizers">
                            <div class='resizer top'
                            *ngIf="!isMobile && data.appointment.isEditable" #topResizer (mousedown)="resize($event, topResizer, data.appointment, eventContainer)"></div>
                            <div class="overflow-hidden">
                              <!-- POP OVER -->
                              <ng-template #eventDetails>
                                <div class="calender-day-view-event-details-expanded">
                                  <div class="d-flex flex-column dfm-gap-4">
                                    <span class="font-weight-medium"> {{"Exam" | translate}}</span>
                                    <span *ngIf="data.exams?.length">{{ data.exams | joinWithAnd : 'name'}}</span>
                                  </div>

                                  <div class="d-flex flex-column dfm-gap-4">
                                    <span class="font-weight-medium dfm-mt-8"> {{"SelectedSlot" | translate}} </span>
                                    <span class="calendar-comments-text">{{ data.appointment.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }} -
                                      {{ data.appointment.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }}</span>
                                  </div>

                                  <div class="d-flex flex-column dfm-gap-4">
                                    <span class="font-weight-medium dfm-mt-8"> {{"Comments" | translate}} </span>
                                    <span class="calendar-comments-text"> {{ data.appointment?.comments | dashIfNothing }}</span>
                                  </div>

                                  <div class="d-flex flex-column dfm-gap-4">
                                    <span class="font-weight-medium dfm-mt-8">{{"Staff" | translate}}</span>
                                    <ng-container *ngIf="data.exams | isData : 'users'; else dash">
                                      <div *ngFor="let exam of data.exams" class="dfm-ps-4 dfm-pt-4">
                                        <div *ngFor="let user of exam?.rooms?.[0]?.users"
                                             class="d-flex align-items-center dfm-gap-8 dfm-pt-4 dfm-pb-4">
                                          <div class="circle-gray-200-40">
                                            {{ user?.firstname?.length ? (user.firstname[0] | uppercase) : '' }}
                                          </div>
                                          <div class="d-flex flex-column">
                                            <span>{{ user?.firstname | titlecase }} {{ user?.lastname | titlecase }}</span>
                                            <span class="dfm-text-main-500">{{ user?.userType | titlecase }}</span>
                                          </div>
                                        </div>
                                      </div>
                                    </ng-container>
                                    <ng-template #dash>
                                      <span>{{ '' | dashIfNothing }}</span>
                                    </ng-template>
                                  </div>
                                </div>
                              </ng-template>
                              <!-- POP OVER ENDS -->

                              <!-- circle for alert start -->
                              <!-- <div class="calendar-week-view-event-circle-icon" [ngClass]="{ 'calendar-week-view-event-circle-icon-sm': eventHeight <= 20 }">
                              </div> -->
                              <!-- circle for alert end -->
                              <div class="calender-day-view-event-details-container" (click)="$event.stopPropagation()"
                                   [ngClass]="{ 'calender-day-view-event-details-container-sm m-0-auto ': +eventHeight <= 40, 'center': +eventContainer.offsetHeight >20 && +eventContainer.offsetHeight <=40 }"
                                   [routerLink]="['/', 'appointment', data.appointment.id, 'view']" queryParamsHandling="merge">
                                <div class="d-flex dfm-gap-4">

                                  <div class="d-flex flex-column calender-day-view-event-title">
                                    <span class=" text-truncate" *ngIf="data?.appointment?.patientFname; else date">
                                      {{data.appointment.id}} - {{ data.appointment.patientFname + ' ' + data.appointment.patientLname }}
                                    </span>
                                    <ng-template #date>
                                      <span class="calender-day-view-event-time">
                                        {{ data.appointment.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }} -
                                        {{ data.appointment.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }}
                                      </span>
                                    </ng-template>

                                    <span class="calender-day-view-event-time" *ngIf="+eventContainer.offsetHeight > 40 && data?.appointment?.patientFname">
                                      {{ data.appointment.startedAt | dfmDefaultDate : 'time' | dfmUtcToLocal : true }} -
                                      {{ data.appointment.endedAt | dfmDefaultDate : 'time' | dfmUtcToLocal: true }}
                                    </span>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div class="calender-day-view-event-more-button" [matMenuTriggerFor]="menu"
                                 >
                              <svg *ngIf="data.appointment.isEditable" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                   xmlns="http://www.w3.org/2000/svg">
                                <path
                                  d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z"
                                  stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path
                                  d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z"
                                  stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path
                                  d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z"
                                  stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>

                              <mat-menu  #menu="matMenu" >
                                <button mat-menu-item
                                          (click)="changeRadiologists(data.appointment);">
                                    <div class="icon-20">
                                      <dfm-icon name="home-03"></dfm-icon>
                                    </div>
                                    <span>{{ 'ChangeRadiologist' | translate }}</span>
                                  </button>

                                  <button  *ngIf="isMobile" mat-menu-item [matMenuTriggerFor]="subMenu"
                                          (click)="$event.stopPropagation()">
                                    <div class="icon-20">
                                      <dfm-icon name="arrow-right"></dfm-icon>
                                    </div>
                                    <span>{{ 'Move' | translate }}</span>
                                    <mat-menu #subMenu="matMenu">
                                      <button mat-menu-item
                                                (click)="openChangeTimeModal(data.appointment, false, eventContainer)">
                                          <span>{{ 'Shorten' | translate }}</span>
                                        </button>

                                        <button mat-menu-item
                                                (click)="openChangeTimeModal(data.appointment, true, eventContainer)">
                                          <span>{{ 'Extend' | translate }}</span>
                                        </button>
                                    </mat-menu>
                                  </button>

                                  <button mat-menu-item
                                          [routerLink]="['/', 'appointment', data.appointment.id, 'edit']"
                                          queryParamsHandling="merge"
                                          [state]="{ edit: true, comingFromRoute: 'appointment' }">
                                    <div class="icon-20">
                                      <dfm-icon name="pencil-02"></dfm-icon>
                                    </div>
                                    <span>{{ 'Edit' | translate }}</span>
                                  </button>

                                  <div class="dropdown-divider"></div>

                                  <button mat-menu-item
                                          (click)=" deleteAppointment(data.appointment.id);">
                                    <div class="icon-20">
                                      <dfm-icon name="trash-01"></dfm-icon>
                                    </div>
                                    <span>{{ 'Delete' | translate}}</span>
                                  </button>
                              </mat-menu>
                            </div>
                            <div class='resizer bottom' *ngIf="!isMobile && data.appointment.isEditable"  #bottomResizer (mousedown)="resize($event, bottomResizer, data.appointment, eventContainer)"  ></div>
                          </div>
                          </div>
                        </ng-container>
                        </ng-container>
                      </ng-container>

                    </ng-container>
                    <ng-container
                      *ngIf="absenceData && absenceData[h.name] as roomData">
                      <ng-container
                        *ngFor="let data of roomData;">
                        <ng-container *ngIf="getAbsenceHeight(data) as eventHeight" >
                          <div  #eventContainer class="calender-day-view-event-container" triggers="hover" [ngbPopover]="absenceDetails"
                                    [autoClose]="'outside'" container="body" (dblclick)="$event.preventDefault()"
                              [ngStyle]="{ 'top.px': getAbsenceTop([data]), 'height.px': eventHeight }"
                          >
                          <!-- POP OVER -->
                          <ng-template #absenceDetails>
                            <div class="calender-day-view-event-details-expanded">


                              <div class="d-flex flex-column dfm-gap-4">
                                <span class="font-weight-medium dfm-mt-8"> {{"AbsenceSlot" | translate}} </span>
                                <span class="calendar-comments-text">{{ data.start }} -
                                  {{ data.end }}</span>
                              </div>

                              <div class="d-flex flex-column dfm-gap-4">
                                <span class="font-weight-medium dfm-mt-8"> {{"Info" | translate}} </span>
                                <span class="calendar-comments-text"> {{ data.info | dashIfNothing }}</span>
                              </div>

                              <div class="d-flex flex-column dfm-gap-4">
                                <span class="font-weight-medium dfm-mt-8"> {{(data?.roomName ? "Room" : 'Staff') | translate}} </span>
                                <span class="calendar-comments-text"> {{ (data.roomName ?? data.userName) | dashIfNothing }}</span>
                              </div>
                            </div>
                          </ng-template>
                          <!-- POP OVER ENDS -->
                          <div class="calender-day-view-event-details-container" (click)="$event.stopPropagation()"
                              [ngClass]="{ 'calender-day-view-event-details-container-sm m-0-auto ': +eventHeight <= 40, 'center': +eventContainer.offsetHeight >20 && +eventContainer.offsetHeight <=40 }"
                              >
                            <div class="d-flex dfm-gap-4" >

                              <div class="d-flex flex-column calender-day-view-event-title">
                                <span class=" text-truncate" *ngIf="data?.name; else date">
                                  {{ data.name }}
                                </span>
                                <ng-template #date>
                                  <span class="calender-day-view-event-time">
                                    {{ data.start }} -
                                    {{ data.end }}
                                  </span>
                                </ng-template>

                                <span class="calender-day-view-event-time" *ngIf="+eventContainer.offsetHeight > 40 && data?.name">
                                  {{ data.start }} -
                                  {{ data.end }}
                                </span>
                              </div>
                            </div>
                          </div>
                          </div>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </div>
                  <div
                    class="calender-day-view-body-events-container drag-backdrop"
                    role="backdrop"
                    [ngClass]="{'drag-started': draggableSvc.isDragStarted}"
                  >
                  </div>

                </div>
              </ng-container>
              <ng-template #singleGridCol>
                <div role="gridcell" class="calender-day-view-body-grid-column">
                  <div></div>
                  <div role="presentation">
                  </div>
                </div>
              </ng-template>
            </div>
          </div>

        </div>
      </div>
      <ng-container *ngIf="!timeSlot?.timings?.length">
        <div class="d-flex flex-1 align-items-center justify-content-center">
          <p >{{"PracticeNotAvailableForDay" | translate}}</p>
        </div>
      </ng-container>
      <ng-container *ngIf="timeSlot?.timings?.length && (isHoliday$$ | async)">
        <div class="d-flex flex-1 align-items-center justify-content-center">
          <p >{{'LabHoliday' | translate}}</p>
        </div>
      </ng-container>
    </div>
  </div>
</div>
